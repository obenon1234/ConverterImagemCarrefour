<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ferramentas Carrefour: OCR, Limpador de Código de Barras, Juntar PDF e Validador</title>
    <!-- Dependências de Estilo e Fontes -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- BIBLIOTECAS ADICIONAIS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        /* Estilos Globais e das Abas Originais */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #0050A4; /* Azul Carrefour */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            color: white;
        }

        .tab-container {
            max-width: 1200px;
            width: 100%;
            background: #FFFFFF;
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: #333333;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
        }

        .tab-buttons {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            gap: 10px;
            flex-wrap: wrap; 
        }

        .tab-button {
            background: #D0D0D0;
            color: #333333;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .tab-button:hover {
            background: #C0C0C0;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .tab-button.active {
            background: linear-gradient(45deg, #ED1C24, #C00000);
            color: white;
            box-shadow: 0 4px 15px rgba(237, 28, 36, 0.4);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            color: #333333;
        }

        .paste-area, .barcode-input-section {
            background: #E0E0E0;
            border: 3px dashed rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            cursor: pointer;
            color: #333333;
        }

        .paste-area:hover, .barcode-input-section:hover {
            border-color: rgba(0, 0, 0, 0.6);
            background: #D0D0D0;
            transform: translateY(-2px);
        }

        .paste-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.7;
            color: #333333;
        }

        .paste-text {
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .paste-hint {
            opacity: 0.8;
            font-size: 0.8rem;
            margin-bottom: 15px;
        }

        .upload-btn, .barcode-clean-btn, .join-pdf-btn {
            background: linear-gradient(45deg, #ED1C24, #C00000);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .upload-btn:hover, .barcode-clean-btn:hover, .join-pdf-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(237, 28, 36, 0.4);
        }

        .ocr-btn {
            background: linear-gradient(45deg, #ED1C24, #C00000);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            margin: 20px 0;
            transition: all 0.3s ease;
            width: 100%;
        }

        .ocr-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(237, 28, 36, 0.4);
        }

        .ocr-btn:disabled, .barcode-clean-btn:disabled, .join-pdf-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .content-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        .image-preview, .text-output, .barcode-output, .pdf-output-area {
            background: #E0E0E0;
            border-radius: 15px;
            padding: 20px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            color: #333333;
        }

        .section-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #333333;
        }

        .preview-img {
            max-width: 100%;
            max-height: 250px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            object-fit: contain;
            margin-bottom: 15px;
            flex-grow: 1;
        }

        .text-result, .barcode-result-text {
            background: #CCCCCC;
            border-radius: 10px;
            padding: 15px;
            min-height: 150px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            line-height: 1.5;
            white-space: pre-wrap;
            overflow-x: auto;
            overflow-y: auto;
            border: 1px solid rgba(0, 0, 0, 0.2);
            flex-grow: 1;
            color: #333333;
        }

        .copy-btn {
            background: linear-gradient(45deg, #ED1C24, #C00000);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            margin-left: auto;
        }

        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(237, 28, 36, 0.4);
        }

        .copy-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .file-input {
            display: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 30px 20px;
            background: #E0E0E0;
            border-radius: 15px;
            margin-bottom: 30px;
            color: #333333;
        }

        .spinner {
            border: 3px solid rgba(0, 0, 0, 0.3);
            border-radius: 50%;
            border-top: 3px solid #333333;
            width: 35px;
            height: 35px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            color: rgba(51, 51, 51, 0.6);
            font-style: italic;
            text-align: center;
            padding: 20px;
        }

        .error-state {
            color: #D32F2F;
            text-align: center;
            padding: 10px;
        }

        .success-state {
            color: #388E3C;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .character-count-info {
            font-size: 0.85rem;
            margin-top: 10px;
            opacity: 0.8;
            color: rgba(51, 51, 51, 0.7);
            text-align: right;
        }

        .footer {
            margin-top: 40px;
            text-align: center;
            color: white;
            font-size: 0.75rem;
            padding: 10px 20px;
            background-color: #0050A4;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .footer-left, .footer-center, .footer-right {
            flex: 1;
            min-width: 150px;
            text-align: center;
        }

        .footer-left { text-align: left; }
        .footer-right { text-align: right; }

        .pdf-input-area {
            background: #E0E0E0;
            border: 3px dashed rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            color: #333333;
        }

        .pdf-input-area:hover {
            border-color: rgba(0, 0, 0, 0.6);
            background: #D0D0D0;
        }

        .pdf-file-list {
            list-style: none;
            padding: 0;
            max-height: 150px;
            overflow-y: auto;
            margin-top: 20px;
            text-align: left;
            border-top: 1px solid #ccc;
            padding-top: 10px;
        }

        .pdf-file-list li {
            background: #F0F0F0;
            padding: 8px 15px;
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: #333;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .pdf-file-list li .remove-file-btn {
            background: none;
            border: none;
            color: #ED1C24;
            font-weight: bold;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0 5px;
            transition: color 0.2s ease;
        }

        .pdf-file-list li .remove-file-btn:hover {
            color: #C00000;
        }

        .download-merged-pdf-btn {
            background: linear-gradient(45deg, #388E3C, #2E7D32);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 20px;
            transition: all 0.3s ease;
            width: 100%;
        }

        .download-merged-pdf-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(56, 142, 60, 0.4);
        }
        
        /* Estilos do Validador de Pagamento */
        #validatorTab body {
             font-family: 'Inter', sans-serif;
        }
        #validatorTab .file-input-container {
            position: relative;
            width: 100%;
            height: 12rem; /* 192px */
            border: 2px dashed #d1d5db; /* gray-300 */
            border-radius: 0.5rem; /* rounded-lg */
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }
        #validatorTab .file-input-container:hover {
            background-color: #f9fafb; /* gray-50 */
        }
        #validator-file-upload {
            display: none;
        }
        #validatorTab .copy-feedback {
            font-size: 0.8rem;
            color: #16a34a; /* green-600 */
            transition: opacity 0.5s ease-in-out;
        }
        
        @keyframes pop-in {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        #validatorTab .status-badge-animation {
            animation: pop-in 0.3s ease-out forwards;
        }

        /* Media Queries para Responsividade */
        @media (max-width: 768px) {
            .content-area {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .tab-container {
                padding: 20px;
            }
            .footer {
                flex-direction: column;
                align-items: center;
            }
            .footer-left, .footer-center, .footer-right {
                text-align: center;
                width: 100%;
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <div class="tab-container">
        <div class="tab-buttons">
            <button class="tab-button active" onclick="openTab('validatorTab')">🛡️ Validador de Pagamento</button>
            <button class="tab-button" onclick="openTab('ocrTab')">🔍 OCR de Números</button>
            <button class="tab-button" onclick="openTab('barcodeTab')">🧹 Limpador de Código de Barras</button>
            <button class="tab-button" onclick="openTab('joinPdfTab')">🔗 Juntar PDF</button>
        </div>

        <!-- Conteúdo da Aba: Validador de Pagamento -->
        <div id="validatorTab" class="tab-content active">
            <div class="w-full bg-white rounded-xl p-6 md:p-8">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-gray-800">Validador de Guias de Pagamento</h1>
                    <p class="text-gray-500 mt-2">Envie uma imagem ou PDF da guia e a IA extrairá os dados.</p>
                </div>

                <div class="mb-6">
                    <label for="validator-file-upload" class="file-input-container" id="validator-drop-zone">
                        <div class="text-center text-gray-500">
                            <i class="fas fa-cloud-upload-alt fa-3x mb-2"></i>
                            <p class="font-semibold">Clique para enviar ou arraste e solte</p>
                            <p class="text-sm">PNG, JPG, WEBP ou PDF</p>
                        </div>
                    </label>
                    <input id="validator-file-upload" type="file" class="file-input" accept="image/png, image/jpeg, image/webp, application/pdf">
                </div>
                <div id="validator-image-preview-container" class="hidden mb-6 text-center">
                    <p class="text-sm font-medium text-gray-600 mb-2">Pré-visualização do Documento:</p>
                    <img id="validator-image-preview" class="max-w-full max-h-80 mx-auto rounded-lg shadow-md" alt="Preview da guia de pagamento">
                </div>
                <div class="text-center mb-6">
                    <button id="validator-process-button" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 transition-all duration-300 shadow-md disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                        <i class="fas fa-cogs mr-2"></i>
                        Extrair Dados
                    </button>
                </div>
                <div id="validator-result-section" class="space-y-4">
                    <div id="validator-loader" class="hidden flex items-center justify-center p-4 bg-gray-50 rounded-lg">
                        <i class="fas fa-spinner fa-spin fa-2x text-indigo-500"></i>
                        <p class="ml-3 text-gray-600">Analisando o documento... Por favor, aguarde.</p>
                    </div>
                    <div id="validator-error-message" class="hidden p-4 bg-red-100 text-red-700 rounded-lg flex items-center">
                        <i class="fas fa-exclamation-triangle mr-3"></i>
                        <span id="validator-error-text"></span>
                    </div>
                    <div id="validator-results-container" class="hidden p-6 bg-green-50 border border-green-200 rounded-lg shadow-sm">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4 text-center">Dados Extraídos com Sucesso!</h3>
                        <div class="space-y-4">
                            <div class="flex items-start p-3 bg-white rounded-md border">
                                <i class="fas fa-building fa-lg text-indigo-500 w-8 text-center mt-1"></i>
                                <div class="ml-4 flex-1">
                                    <p class="text-sm text-gray-500">Fornecedor Identificado</p>
                                    <p id="validator-supplier-name" class="text-lg font-semibold text-gray-700"></p>
                                    <p id="validator-supplier-number" class="text-sm font-mono text-gray-500 mt-1"></p>
                                </div>
                            </div>
                            <div class="flex items-start p-3 bg-white rounded-md border">
                                <i class="fas fa-user fa-lg text-indigo-500 w-8 text-center mt-1"></i>
                                <div class="ml-4 flex-1">
                                    <p class="text-sm text-gray-500">Pagador Identificado</p>
                                    <p id="validator-payer-name" class="text-lg font-semibold text-gray-700"></p>
                                </div>
                            </div>
                            <div class="flex items-start p-3 bg-white rounded-md border">
                                <i class="fas fa-dollar-sign fa-lg text-indigo-500 w-8 text-center mt-1"></i>
                                <div class="ml-4 flex-1">
                                    <p class="text-sm text-gray-500">Valor do Documento</p>
                                    <p id="validator-payment-value" class="text-lg font-semibold text-gray-700"></p>
                                </div>
                                <button onclick="validatorCopyToClipboard('validator-payment-value', 'validator-feedback-value')" class="p-2 text-gray-400 hover:text-indigo-600 ml-2">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <span id="validator-feedback-value" class="copy-feedback ml-2 opacity-0">Copiado!</span>
                            </div>
                            <div class="flex items-start p-3 bg-white rounded-md border">
                                <i class="fas fa-calendar-alt fa-lg text-indigo-500 w-8 text-center mt-1"></i>
                                <div class="ml-4 flex-1">
                                    <p class="text-sm text-gray-500">Data de Vencimento</p>
                                    <p id="validator-due-date" class="text-lg font-semibold text-gray-700"></p>
                                    <div id="validator-due-date-status" class="mt-2 hidden">
                                        <span id="validator-due-date-badge" class="inline-flex items-center px-3 py-1.5 rounded-full text-sm font-bold shadow-md">
                                        </span>
                                    </div>
                                </div>
                                <button onclick="validatorCopyToClipboard('validator-due-date', 'validator-feedback-due-date')" class="p-2 text-gray-400 hover:text-indigo-600 ml-2">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <span id="validator-feedback-due-date" class="copy-feedback ml-2 opacity-0">Copiado!</span>
                            </div>
                            <div class="flex items-start p-3 bg-white rounded-md border">
                                <i class="fas fa-barcode fa-lg text-indigo-500 w-8 text-center mt-1"></i>
                                <div class="ml-4 flex-1 min-w-0">
                                    <p class="text-sm text-gray-500">Código de Barras (Original)</p>
                                    <div class="bg-gray-100 p-2 rounded-md mt-1">
                                        <p id="validator-barcode-original" class="text-base font-mono text-gray-600 break-all"></p>
                                    </div>
                                    <p class="text-sm text-gray-500 mt-3">Código de Barras (Apenas Números)</p>
                                    <div class="bg-gray-50 p-2 rounded-md mt-1">
                                        <p id="validator-barcode-cleaned" class="text-base md:text-lg font-mono text-gray-800 break-all"></p>
                                    </div>
                                    <p id="validator-barcode-validation" class="text-sm text-yellow-600 font-sans mt-1 hidden"></p>
                                </div>
                                <button onclick="validatorCopyToClipboard('validator-barcode-cleaned', 'validator-feedback-barcode')" class="p-2 text-gray-400 hover:text-indigo-600 ml-2">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <span id="validator-feedback-barcode" class="copy-feedback ml-2 opacity-0">Copiado!</span>
                            </div>
                        </div>
                        <!-- ÁREA DE AÇÕES -->
                        <div class="mt-6 text-center space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl mx-auto">
                                <div>
                                    <label for="area-direito-select" class="block text-sm font-medium text-gray-700 mb-1">Área do Direito</label>
                                    <select id="area-direito-select" class="block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></select>
                                </div>
                                <div>
                                    <label for="tipo-pagamento-select" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Pagamento</label>
                                    <select id="tipo-pagamento-select" class="block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" disabled></select>
                                </div>
                            </div>
                            <div>
                                <label for="validator-id-input" class="block text-sm font-medium text-gray-700 mb-1">ID Padrão (Opcional)</label>
                                <input type="text" id="validator-id-input" class="mx-auto max-w-xs text-center shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md p-2" placeholder="Digite o ID para o nome do arquivo">
                            </div>
                            <div class="flex justify-center items-center gap-4">
                                <button id="validator-save-button" class="bg-green-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-700 transition-all duration-300 shadow-md hidden">
                                    <i class="fas fa-save mr-2"></i>
                                    Salvar Guia
                                </button>
                                <button id="validator-batch-button" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition-all duration-300 shadow-md hidden">
                                    <i class="fas fa-file-excel mr-2"></i>
                                    Gerar Batch Input (.xlsx)
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Conteúdo da Aba: OCR de Números -->
        <div id="ocrTab" class="tab-content">
            <h1>🔍 Carrefour - Extração de Números</h1>
            <div class="paste-area" id="ocrPasteArea">
                <div class="paste-icon">📋</div>
                <div class="paste-text">Cole sua imagem aqui com Ctrl+V</div>
                <div class="paste-hint">Ou arraste e solte uma imagem • Códigos de barras, documentos, screenshots</div>
                <input type="file" class="file-input" id="ocrFileInput" accept="image/*">
                <button class="upload-btn" onclick="document.getElementById('ocrFileInput').click()">
                    📁 Selecionar Arquivo
                </button>
            </div>
            <div class="loading" id="ocrLoading">
                <div class="spinner"></div>
                <div id="ocrLoadingText">Inicializando OCR...</div>
            </div>
            <div class="content-area" id="ocrContentArea" style="display: none;">
                <div class="image-preview">
                    <div class="section-title">🖼️ Imagem Original</div>
                    <img id="previewImage" class="preview-img" alt="Preview da imagem">
                    <button class="ocr-btn" id="ocrProcessBtn" onclick="performOCR()">🔍 Extrair Texto</button>
                </div>
                <div class="text-output">
                    <div class="section-title">
                        📝 Texto Extraído
                        <button class="copy-btn" id="copyOcrBtn" onclick="copyOcrText()" disabled>📋 Copiar</button>
                    </div>
                    <div class="text-result" id="ocrTextResult">
                        <div class="empty-state">Cole ou envie uma imagem e clique em "Extrair Texto".</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Conteúdo da Aba: Limpador de Código de Barras -->
        <div id="barcodeTab" class="tab-content">
            <h1>🧹 Limpador de Código de Barras</h1>
            <div class="barcode-input-section">
                <div class="paste-icon">📄</div>
                <div class="paste-text">Cole seu código de barras aqui</div>
                <textarea id="barcodeInput" placeholder="Ex: 1234.567-890 123,45" class="w-full min-h-[120px] p-2.5 rounded-lg border border-gray-300 resize-y font-mono text-base mt-4"></textarea>
                <button class="barcode-clean-btn" id="cleanBarcodeBtn" onclick="cleanBarcode()">✨ Limpar Código</button>
            </div>
            <div class="barcode-output">
                <div class="section-title">
                    🔢 Código Limpo
                    <button class="copy-btn" id="copyBarcodeBtn" onclick="copyBarcode()" disabled>📋 Copiar</button>
                </div>
                <div class="barcode-result-text" id="cleanedBarcodeResult">
                    <div class="empty-state">O código de barras limpo aparecerá aqui.</div>
                </div>
            </div>
        </div>

        <!-- Conteúdo da Aba: Juntar PDF -->
        <div id="joinPdfTab" class="tab-content">
            <h1>🔗 Carrefour - Juntar PDFs</h1>
            <p style="text-align: center; margin-bottom: 20px; color: #555;">
                Selecione múltiplos arquivos PDF para combiná-los em um único documento.
            </p>
            <div class="pdf-input-area" id="pdfDropArea">
                <div class="paste-icon">➕</div>
                <div class="paste-text">Arraste e solte seus arquivos PDF aqui</div>
                <div class="paste-hint">Ou clique para selecionar arquivos (você pode selecionar vários)</div>
                <input type="file" class="file-input" id="pdfFileInput" accept=".pdf" multiple>
                <button class="upload-btn" onclick="document.getElementById('pdfFileInput').click()">📂 Selecionar Arquivos PDF</button>
                <ul id="pdfFileList" class="pdf-file-list"></ul>
            </div>
            <div class="loading" id="pdfLoading" style="display: none;">
                <div class="spinner"></div>
                <div id="pdfLoadingText">Juntando PDFs...</div>
            </div>
            <button class="join-pdf-btn" id="joinPdfProcessBtn" onclick="joinPdfs()" disabled>✨ Juntar PDFs Selecionados</button>
            <div class="pdf-output-area" id="pdfOutputArea" style="display: none;">
                <div class="section-title">✅ PDF Combinado</div>
                <div class="text-result" id="mergedPdfResult">
                    <div class="empty-state">O PDF resultante aparecerá aqui.</div>
                </div>
                <button class="download-merged-pdf-btn" id="downloadPdfBtn" disabled>⬇️ Baixar PDF Combinado</button>
            </div>
        </div>
        
    </div>

    <footer class="footer">
        <div class="footer-left">© 2025 - Ferramenta interna do Carrefour</div>
        <div class="footer-center">CSC - Transformar informação em solução</div>
        <div class="footer-right">Criador: Luiz Fraga</div> 
    </footer>

    <!-- Bibliotecas JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.4/tesseract.min.js"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    
    <script>
        // --- Lógica Principal da Aplicação ---
        
        // --- Funções do Sistema de Abas ---
        function openTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            const clickedButton = Array.from(document.querySelectorAll('.tab-button')).find(button => button.onclick.toString().includes(`openTab('${tabId}')`));
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
        }

        // --- Lógica para a aba "Validador de Pagamento" ---
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js`;

        const validatorElements = {
            fileUpload: document.getElementById('validator-file-upload'),
            dropZone: document.getElementById('validator-drop-zone'),
            previewContainer: document.getElementById('validator-image-preview-container'),
            previewImage: document.getElementById('validator-image-preview'),
            processButton: document.getElementById('validator-process-button'),
            loader: document.getElementById('validator-loader'),
            errorMessage: document.getElementById('validator-error-message'),
            errorText: document.getElementById('validator-error-text'),
            resultsContainer: document.getElementById('validator-results-container'),
            dueDate: document.getElementById('validator-due-date'),
            barcodeOriginal: document.getElementById('validator-barcode-original'),
            barcodeCleaned: document.getElementById('validator-barcode-cleaned'),
            barcodeValidation: document.getElementById('validator-barcode-validation'),
            dueDateStatus: document.getElementById('validator-due-date-status'),
            supplierName: document.getElementById('validator-supplier-name'),
            supplierNumber: document.getElementById('validator-supplier-number'),
            payerName: document.getElementById('validator-payer-name'),
            paymentValue: document.getElementById('validator-payment-value'),
            saveButton: document.getElementById('validator-save-button'),
            batchButton: document.getElementById('validator-batch-button'),
            idInput: document.getElementById('validator-id-input'),
            areaDireitoSelect: document.getElementById('area-direito-select'),
            tipoPagamentoSelect: document.getElementById('tipo-pagamento-select')
        };

        let validatorState = {
            fileMimeType: null,
            base64Image: null,
            originalFile: null,
            extractedData: {}, // Armazena os dados extraídos
            rawText: '' // Armazena o texto bruto do documento
        };

        const contasContabeis = {
            "Trabalhista": { "Acordo": "60020100", "Pensão Vitalicia": "60020100", "Condenação/Sentença": "60020100", "HONORÁRIOS SUCUMBÊNCIAIS": "60020100", "Custas Judiciais": "60020000", "Depósito Judicial - CCI": "12500100", "Depósito Recursal": "12500100", "Encargos": "60020100", "Honorários": "60020000", "Multas": "61540500", "GPS": "60020100", "IR": "60020100", "Pagamento Remanescente": "60020100" },
            "Cível": { "Acordo": "61500801", "Aluguel": "64010000", "Condenação/Sentença": "61500801", "HONORÁRIOS SUCUMBÊNCIAIS": "61500801", "Custas Judiciais": "61500065", "Depósito Judicial - CCI": "12500090", "Encargos": "61500065", "Honorários": "61500065", "Multas": "61500801", "OAB": "61540610", "Pagamento Remanescente": "61500801", "Pensão Vitalicia": "61500801", "Treinamento": "61306000", "Confraternização": "61540800", "LIMINAR CCI": "61500801" },
            "Regulatório": { "Acordo": "61500801", "Aluguel": "64010000", "Condenação/Sentença": "61500801", "HONORÁRIOS SUCUMBÊNCIAIS": "61500801", "Custas Judiciais": "61500065", "Depósito Judicial - CCI": "12500090", "Encargos": "61500065", "Honorários": "61500065", "Multas": "61500801", "OAB": "61540610", "Pagamento Remanescente": "61500801", "Pensão Vitalicia": "61500801", "Treinamento": "61306000", "Confraternização": "61540800", "LIMINAR CCI": "61500801" },
            "Imobiliário": { "Acordo": "64010740", "Condenação/Sentença": "64010740", "Custas Judiciais": "64010741", "HONORÁRIOS SUCUMBÊNCIAIS": "64010740", "Despesas Imobiliario": "64010741", "Honorarios": "64010741", "Emolumentos": "61301100", "DEPÓSITO JUDICIAL - CCI": "12500090", "HONORÁRIOS": "64010741", "ALUGUEL": "64010740" }
        };

        function validatorImageToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
            });
        }
        
        async function extractTextFromPdf(file) {
            const fileReader = new FileReader();
            return new Promise((resolve, reject) => {
                fileReader.onload = async function() {
                    const typedarray = new Uint8Array(this.result);
                    try {
                        const pdf = await pdfjsLib.getDocument(typedarray).promise;
                        const page = await pdf.getPage(1);
                        const textContent = await page.getTextContent();
                        const text = textContent.items.map(item => item.str).join(' ');
                        resolve(text);
                    } catch (err) {
                        reject(err);
                    }
                };
                fileReader.readAsArrayBuffer(file);
            });
        }

        async function validatorRenderPdfToImage(file) {
            const fileReader = new FileReader();
            return new Promise((resolve, reject) => {
                fileReader.onload = async function() {
                    const typedarray = new Uint8Array(this.result);
                    try {
                        const pdf = await pdfjsLib.getDocument(typedarray).promise;
                        const page = await pdf.getPage(1);
                        const viewport = page.getViewport({ scale: 2.0 });
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;
                        await page.render({ canvasContext: context, viewport: viewport }).promise;
                        const dataUrl = canvas.toDataURL('image/jpeg', 0.95);
                        resolve({
                            previewUrl: dataUrl,
                            base64: dataUrl.split(',')[1],
                            mimeType: 'image/jpeg'
                        });
                    } catch (pdfError) {
                        console.error('Erro ao processar PDF:', pdfError);
                        reject(new Error('Não foi possível ler o arquivo PDF. Ele pode estar corrompido ou protegido.'));
                    }
                };
                fileReader.readAsArrayBuffer(file);
            });
        }

        async function validatorHandleFileSelect(selectedFile) {
            if (!selectedFile) return;
            validatorState.originalFile = selectedFile;
            validatorState.rawText = ''; // Limpa o texto anterior
            const validTypes = ['image/png', 'image/jpeg', 'image/webp', 'application/pdf'];
            if (!validTypes.includes(selectedFile.type)) {
                validatorShowError('Por favor, selecione um arquivo de imagem (PNG, JPG, WEBP) ou PDF.');
                return;
            }
            validatorHideAllMessages();
            validatorElements.processButton.disabled = true;
            validatorShowLoader('Processando o arquivo...');
            try {
                if (selectedFile.type === 'application/pdf') {
                    const pdfData = await validatorRenderPdfToImage(selectedFile);
                    validatorState.rawText = await extractTextFromPdf(selectedFile); // Extrai texto para verificação
                    validatorElements.previewImage.src = pdfData.previewUrl;
                    validatorState.base64Image = pdfData.base64;
                    validatorState.fileMimeType = pdfData.mimeType;
                } else {
                    validatorElements.previewImage.src = URL.createObjectURL(selectedFile);
                    validatorState.base64Image = await validatorImageToBase64(selectedFile);
                    validatorState.fileMimeType = selectedFile.type;
                }
                validatorElements.previewContainer.classList.remove('hidden');
                validatorElements.processButton.disabled = false;
            } catch (error) {
                console.error('Erro ao preparar arquivo:', error);
                validatorShowError(error.message || 'Ocorreu um erro ao processar o arquivo.');
                validatorElements.previewContainer.classList.add('hidden');
            } finally {
                validatorHideLoader();
            }
        }

        function setupValidatorEventListeners() {
            validatorElements.fileUpload.addEventListener('change', (e) => validatorHandleFileSelect(e.target.files[0]));
            validatorElements.dropZone.addEventListener('dragover', (e) => { e.preventDefault(); e.stopPropagation(); validatorElements.dropZone.classList.add('bg-indigo-50'); validatorElements.dropZone.style.borderColor = '#4f46e5'; });
            validatorElements.dropZone.addEventListener('dragleave', (e) => { e.preventDefault(); e.stopPropagation(); validatorElements.dropZone.classList.remove('bg-indigo-50'); validatorElements.dropZone.style.borderColor = '#d1d5db'; });
            validatorElements.dropZone.addEventListener('drop', (e) => { e.preventDefault(); e.stopPropagation(); validatorElements.dropZone.classList.remove('bg-indigo-50'); validatorElements.dropZone.style.borderColor = '#d1d5db'; const droppedFile = e.dataTransfer.files[0]; validatorHandleFileSelect(droppedFile); });
            validatorElements.processButton.addEventListener('click', processWithGemini);
            validatorElements.saveButton.addEventListener('click', saveGuideWithCustomName);
            validatorElements.batchButton.addEventListener('click', generateBatchInput);
        }

        function validatorShowLoader(message = 'Analisando o documento... Por favor, aguarde.') { 
            validatorHideAllMessages(); 
            validatorElements.loader.querySelector('p').textContent = message;
            validatorElements.loader.classList.remove('hidden'); 
            validatorElements.processButton.disabled = true; 
        }
        function validatorHideLoader() { validatorElements.loader.classList.add('hidden'); validatorElements.processButton.disabled = false; }
        function validatorShowError(message) { validatorHideAllMessages(); validatorElements.errorText.textContent = message; validatorElements.errorMessage.classList.remove('hidden'); }
        
        function validatorShowResults(data) {
            validatorHideAllMessages();
            validatorState.extractedData = data; // Armazena os dados para usar no salvamento
            const { dueDate, rawBarcode, cleanedBarcode, supplierName, supplierNumber, payerName, paymentValue, validationMsg, dueDateStatus } = data;
            
            validatorElements.dueDate.textContent = dueDate || 'Não encontrado';
            validatorElements.barcodeOriginal.textContent = rawBarcode || 'Não encontrado';
            validatorElements.barcodeCleaned.textContent = cleanedBarcode || 'Não encontrado';
            validatorElements.supplierName.textContent = supplierName || 'Não identificado';
            validatorElements.supplierNumber.textContent = supplierNumber ? `Número: ${supplierNumber}` : '';
            validatorElements.payerName.textContent = payerName || 'Não identificado';
            validatorElements.paymentValue.textContent = paymentValue ? `R$ ${paymentValue}` : 'Não encontrado';

            if (validationMsg) {
                validatorElements.barcodeValidation.textContent = validationMsg;
                validatorElements.barcodeValidation.classList.remove('hidden');
            }
            if (dueDateStatus) {
                const badge = document.getElementById('validator-due-date-badge');
                badge.className = dueDateStatus.classes;
                badge.textContent = `${dueDateStatus.icon} ${dueDateStatus.text}`;
                validatorElements.dueDateStatus.classList.add('status-badge-animation');
                validatorElements.dueDateStatus.classList.remove('hidden');
            }
            validatorElements.resultsContainer.classList.remove('hidden');
            validatorElements.saveButton.classList.remove('hidden');
            validatorElements.batchButton.classList.remove('hidden');
        }

        function validatorHideAllMessages() {
            validatorElements.loader.classList.add('hidden');
            validatorElements.errorMessage.classList.add('hidden');
            validatorElements.resultsContainer.classList.add('hidden');
            validatorElements.barcodeValidation.classList.add('hidden');
            validatorElements.saveButton.classList.add('hidden');
            validatorElements.batchButton.classList.add('hidden');
            if (validatorElements.dueDateStatus.classList.contains('status-badge-animation')) {
                validatorElements.dueDateStatus.classList.remove('status-badge-animation');
            }
            validatorElements.dueDateStatus.classList.add('hidden');
        }

        function validatorCopyToClipboard(elementId, feedbackId) {
            const textToCopy = document.getElementById(elementId).textContent;
            if (!textToCopy || textToCopy === 'Não encontrado') return;
            const cleanText = textToCopy.replace('R$ ', '');
            
            const textArea = document.createElement("textarea");
            textArea.value = cleanText;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                const feedbackElement = document.getElementById(feedbackId);
                feedbackElement.style.opacity = '1';
                setTimeout(() => { feedbackElement.style.opacity = '0'; }, 2000);
            } catch (err) {
                console.error('Falha ao copiar o texto: ', err);
            }
            document.body.removeChild(textArea);
        }

        async function processWithGemini() {
            if (!validatorState.base64Image) {
                validatorShowError('Nenhum documento selecionado para processar.');
                return;
            }
            // A chave da API será fornecida pelo ambiente em tempo de execução.
            const apiKey = ""; 
            validatorShowLoader();
            
            const predefinedSupplierList = `3010010117,AMERICAN CHAMBER;3010012976,BANCO DO BRASIL S.A;3010015717,CAIXA ECONOMICA;3010016266,CONSELHO REGIONAL DE FARMACIA;3010012045,CONSELHO REGIONAL DE MEDICINA VETERINARIA;3070000164,BANCO DE BRASILIA;3050000121,TJ PR - PARANA;3050000083,ESTADO DE GOIÁS;3050000081,ESTADO DO RIO GRANDE DO SUL;3010012036,FUNJECC CAMPO GRANDE;3050000076,GOVERNO DO ESTADO DO RIO DE JANEIRO;3010012197,IBAMA;3010016730,INMETRO;3050000084,ESTADO DO MUNICIPIO DE MATO GROSSO DO SUL;3010028766,ESTADO DO CEARÁ;3050000030,MUNICIPIO DE BELFORD ROXO;3050000023,MUNICIPIO DE JUIZ DE FORA;3050000033,MUNICÍPIO DE GUARUJÁ;3010016308,MUNICIPIO DE SÃO PAULO;3050000039,MUNICIPIO DE PRAIA GRANDE;3050000002,MUNICIPIO DE RIBEIRÃO PRETO;3050000035,MUNICIPIO DE TAUBATÉ;3050000011,MUNICIPIO DE SOROCABA;3050000139,MUNICIPIO JABOATAO DOS GUARARAPES;3050000073,PREFEITURA DE CANOAS;3050000050,PREFEITURA BELO HORIZONTE;3050000016,PREFEITURA DE ANAPOLIS;3050000015,PREFEITURA DE APARECIDA DE GO;3050000057,prefeitura de campinas;3010027337,PREFEITURA DE SÃO VICENTE;3050000034,PREFEITURA DE LIMEIRA;3050000028,PREFEITURA DE NOVA IGUAÇU;3050000040,PREFEITURA DE PIRACICABA;3050000068,PREFEITURA DE PORTO ALEGRE;3050000075,PREFEITURA DE RECIFE;3050000006,PREFEITURA DE SAO BERNARDO DO CAMPO;3050000058,PREFEITURA DE SANTOS;3010016265,PREFEITURA DO RIO DE JANEIRO;3050000032,PREFEITURA INDAIATUBA;3010011977,PREFEITURA JOÃO PESSOA;3010009076,PREFEITURA MUNICIPAL DE GUARULHOS;3050000005,PREFEITURA SÃO JOSÉ DO RIO PRETO;3010027253,PREFEITURA SÃO JOSÉ DOS CAMPOS;3050000047,PREFEITURA MUNICIPAL DE GRAVATAÍ;3050000020,PREFEITURA DE FORTALEZA;3010020477,PREFEITURA MUNICIPAL DE VITORIA DA CONQUISTA;3050000071,PREFEITURA MUNICIPAL DE CABEDELO;3050000059,PREFEITURA DO MUNICIPIO DE SAO CAETANO DO SUL;3010027209,PROCON CAMPINAS;3010012146,PROCON SP;3010012047,PROCON MUNICIPAL DE NATAL;3010012256,PROCURADORIA DO RJ;3010012288,REGRISTRADORES.ORG;3050000106,SECRETARIA DA RECEITA FEDERAL;3050000079,SECRETARIA DO ESTADO DA FAZENDA;3050000082,SECRETARIA DO ESTADO DA FAZENDA;3010012273,SUPREMO TRIBUNAL FEDERAL;3010012010,TJ AMAZONAS;3050000122,TJ CEARA;3050000104,TJ DISTRITO FEDERAL;3050000103,TJ ESPIRITO SANTO;3010021082,TJ GOIAS;3050000100,TJ MINAS Gerais;3010012008,TJ MS;3050000094,TJ PARAIBA;3010021234,TJ PERNAMBUCO;3050000102,TJ RIO DE JANEIRO;3010012110,TJ RIO GRANDE DO NORTE;3010011934,TJ SANTA CATARINA;30100101,TJ SÃO PAULO;3010030378,TJ BAHIA;3010038603,TJ MARANHAO;3010023489,TJ PARA;3010012041,CONSELHO REGIONAL DE MEDICINA VETERINARIA - GO;3010012050,AGENCIA NACIONAL DE VIGILANCIA SANITARIA;3010019896,FUNDO S MUNICIPAL DE CAMPIINAS;3010012036,FUNDO ESPECIAL PARA INSTA;3010012073,JUNTA COMERCIAL DO ESTADO NO PARANÁ;3050000119,SUPERIOR TRIBUNAL DE JUSTIÇA;3050000019,PREFEITURA MANAUS;3010018843,SECRETARIA DO ESTADO DA FAZENDA DE MINAS GERAIS;3010021234,Tribunal de Justiça de Pernambuco;3010042592,SERGIPE JUSTICA ESTADUAL;3050000116,Bahia;3010050178,FUNDO ESTADUAL DE PROTECAO E DEFESA DO C;3010027209,PROCON-MUNICIAL CAMPINAS;3010008367,PREFEITURA MUNICIPAL DE VITORIA;3050000088,ESTADO DA PARAIBA;3010049991,PROCON BA SJDH;3010043339,PREFEITURA MUNICIPAL FEIRA DE SANTANA;3050000152,OPERADOR NACIONAL;3010045642,FUNDO ESPECIAL DE MODERNI <TJ ALAG;3010045413,PREFEITURA MUNICIAL DE CHAPECO;3010042394,AGENCIA NACIONAL DE SAÚDE;3010016303,JUNTA COMERCIAL DO ESTADO RIO GRANDE DO NORTE;3050000060,PREFEITURA DE LONDRINA;3010039992,ESTADO DO MARANHAO;3050000008,MUNICIPIO SAO GONÇALO;3010011487,CEEE;3010043657,ASSOCIAÇÃO DOS PROCURADOS ESTADO DE ALAGOAS;3010051148,PROCON FUNDO DIFUS;3050000043,MUNICIPIO DE BARUERI;3050000048,MUNICIPIO DE CAXIAS DO SUL;3010012205,PROCON JOAO PESSOA;3010019793,GOVERNO DO ESTADO DE ALAGOAS;3010043683,BANCO DO ESTADO DE SERGIPE;3010050191,ALPHA DEPOSITO DE MERCADORIA;3010043494,FUNDO DEFESA DOS DIREITOS;3010012146,PROCON;3010042544,CREA-RS;3010016266,CONSELHO FEDERAL FARMACIA;3010016282,MUNICIPIO DO CABO DE SANTO;3010027209,PROCON - PREF MUNI CAMPINAS;3010043393,PREFEITURA MUNICIAL SALVADOR;3010043543,MUNICIPIO DE JANDIRA;3010012047,INST MUN PROT DEF CONSUMIDOR;3010049416,MUNICPIO DE LAURO DE FREI;3050000086,SECRETARIA DA FAZENDA DO CEARA;3050000080,SECRETARIA DA FAZENDA DO DF;3050000017,PREFEITURA DE GOIANIA;3050000083,ESTADO DE GOIAS SEC DA ECONOMIA;3050000086,SEFAZ CEARA;3010043207,FUNDO MUNICIPAL DE SAUDE;3010044959,MUNICIPIO MARINGA;3010043162,AGENCIA DESTAK DE PUBLICIDADE;3050000018,PREFEITURA CAMPO GRANDE;3010055906,SANTANDER AUTO S.A.;3010055481,JADY FERNANDES BRASILEIRO 4110;3010055141,CURITIBA - SECRETARIA MUNICIPAL DO MEIO AMBIENTE;3010055096,COORDENAÇÃO-GERAL DE ORÇAMENTO, FINANÇAS E CONTABILIDADE;3010041743,MUNICIPIO DE UBERLANDIA;3010054936,FUNDO ESPECIAL DO PODER JUDICIARIO DO ESTADO DE RORAIMA;3050000155,COLEGIO NOTARIAL DO BRASIL SECAO DE SAO PAULO;3050000077,ESTADO DO PARANÁ;3010012044,CONSELHO FFEDERAL MEDICINA RJ;3010041355,CAIXA ESPECIAL SUCUMBENCIA;3050000062,MUNICIPIO DE BALNEARIO CAMBORIU;3010012320,MUNICIPIO DE CONTAGEM;3010043434,MUNICIPIO DE SANTA CRUZ DO SUL;3010024818,PREFEITURA FERRAZ DE VASCONCELOS;3050000159,MUNICIPIO DE CAMPO LARGO;30100160,CONSELHO REGIONAL DE ENGENHARIA E AGRONOMIA DO ESTADO DE RONDONIA;3010053714,CARTORIO DO 5 OFICIO DE JUSTICA DA COMARCA DE SAO GONCALO;3050000089,GOVERNO DO ESTADO DE PERNAMBUCO;3010053919,4º SERVICO DE REGISTRO DE IMOVEIS DA CAPITAL;3010042769,PREFEITURA FOZ IGUAÇU;3010051221,FECON;3010043107,MUNICIPIO DE AMERICANA;3010053749,FUNDO MUNICIPAL PROTEÇÃO E DEFESA DO CONSUMIDOR;3010035659,PREFEITURA MACEIO;3010043589,PREJEITURA ARACAJU;3010016266,"CONSELHO FEDERAL DE FARMÁCIA - CRF-PR";3010043162,Destak Publicidade;3010054209,"FUNDO REGIONAL DE PROTECAO E DEFESA DO CONSUMIDOR-FRPDC";3010054210,SECRETARIA DE ESTADO DO AMBIENTE E SUSTENTABILIDADE;3010054432,ASSOCIACAO DOS PROCURADORES E ADVOGADOS DO MUNICIPIO DE DIADEMA;3050000049,MUNICIPIO DE DIADEMA;3010017744,FGTS;3010042591,MUNICIPIO ITAJAÍ;3010054705,FUNDO AMBIENTAL;3010054933,5 OFICIAL DE REGISTRO DE IMOVEIS DA CAPITAL;3010041986,TRIBUNAL DE JUSTICA PERNAMBUCO;3050000094,TRIBUNAL DE JUSTICA PARAÍBA;3050000108,SECRETARIA DO TESOURO NACIONAL;3050000111,SEFAZ SP`;
            
            const prompt = `Sua tarefa é agir como um especialista em extração de dados de documentos financeiros. Analise a imagem de uma guia de pagamento com MÁXIMA precisão. A seguir, uma lista de possíveis fornecedores no formato "NÚMERO,NOME":\n---\n${predefinedSupplierList}\n---\nSiga estes passos CRÍTICOS:\n1. **Extraia a Linha Digitável Completa:** Sua prioridade máxima é localizar o código de barras e extrair a sequência numérica completa, incluindo todos os espaços, pontos e traços, exatamente como está na imagem. NÃO INVENTE NÚMEROS. A precisão deste campo é essencial.\n2. **Identifique o Fornecedor (Beneficiário):** Sua prioridade é identificar o **beneficiário final** do pagamento, não o banco que processa a guia. Procure pelos campos 'Beneficiário', 'Cedente' ou 'Recebedor'. Se o nome do beneficiário corresponder a um item na sua lista de fornecedores, use-o. O nome do banco (ex: CAIXA, BANCO DO BRASIL) só deve ser usado como último recurso se nenhum outro beneficiário for encontrado. Uma exceção importante: para o CNPJ do Beneficiário 00.360.305/0001-04, o fornecedor é SEMPRE CAIXA ECONOMICA.\n3. **Extraia a Data de Vencimento:** Localize a data e formate-a como DD/MM/AAAA.\n4. **Extraia o Valor do Documento:** Encontre o valor total a ser pago e retorne como uma string.\n5. **Extraia o Nome do Pagador:** Encontre o nome do pagador no documento. Geralmente está associado a um CNPJ ou ao campo 'Pagador'.\n6. **Formate a Resposta:** Retorne um objeto JSON com as chaves "vencimento", "codigo_barras", "valor", "fornecedor" e "nome_pagador". O valor de "fornecedor" DEVE SER UM OBJETO contendo as chaves "numero" e "nome". Se nenhum fornecedor for encontrado, retorne null para o objeto "fornecedor".`;
            
            const payload = {
                contents: [{ parts: [ { text: prompt }, { inlineData: { mimeType: validatorState.fileMimeType, data: validatorState.base64Image } } ] }],
                generationConfig: { responseMimeType: "application/json" }
            };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) {
                    const errorBody = await response.json();
                    const detailedMessage = errorBody.error?.message || `Status ${response.status}`;
                    throw new Error(`Erro da API: ${detailedMessage}`);
                }
                const result = await response.json();
                if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0]) {
                    const textResponse = result.candidates[0].content.parts[0].text;
                    const cleanTextResponse = textResponse.replace(/^```json\s*|```\s*$/g, '');
                    const parsedJson = JSON.parse(cleanTextResponse);
                    handleApiResponse(parsedJson);
                } else {
                    const reason = result.candidates?.[0]?.finishReason;
                    if (reason === 'SAFETY') {
                        validatorShowError('A análise foi bloqueada por segurança. A imagem pode conter informações sensíveis.');
                    } else {
                        validatorShowError('A resposta da IA não continha os dados esperados. Verifique a qualidade da imagem.');
                    }
                }
            } catch (error) {
                console.error('Erro ao chamar a API do Gemini:', error);
                validatorShowError(error.message || 'Ocorreu um erro de comunicação com a IA.');
            } finally {
                validatorHideLoader();
            }
        }

        function handleApiResponse(parsedJson) {
            const cleanedBarcode = parsedJson.codigo_barras ? parsedJson.codigo_barras.replace(/\D/g, '') : null;
            let validationMessage = null;
            if (cleanedBarcode && !(cleanedBarcode.length === 47 || cleanedBarcode.length === 48)) {
                validationMessage = `Atenção: O código possui ${cleanedBarcode.length} dígitos. O padrão é 47 (boletos) ou 48 (tributos).`;
            }
            
            let dueDateStatus = null;
            if (parsedJson.vencimento && /^\d{2}\/\d{2}\/\d{4}$/.test(parsedJson.vencimento)) {
                const parts = parsedJson.vencimento.split('/');
                const dueDateObject = new Date(parseInt(parts[2]), parseInt(parts[1]) - 1, parseInt(parts[0]));
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const threeDaysFromNow = new Date();
                threeDaysFromNow.setHours(0, 0, 0, 0);
                threeDaysFromNow.setDate(today.getDate() + 3);
                
                if (dueDateObject < today) {
                    dueDateStatus = { text: "GUIA VENCIDA", icon: "😢", classes: "inline-flex items-center px-3 py-1.5 rounded-full text-sm font-bold shadow-md bg-red-500 text-white" };
                } else if (dueDateObject <= threeDaysFromNow) {
                    const daysDiff = Math.ceil((dueDateObject - today) / (1000 * 60 * 60 * 24));
                    const dayText = daysDiff <= 1 ? 'DIA' : 'DIAS';
                    dueDateStatus = { text: `VENCE EM ${daysDiff} ${dayText}`, icon: "😟", classes: "inline-flex items-center px-3 py-1.5 rounded-full text-sm font-bold shadow-md bg-yellow-500 text-white" };
                } else {
                    dueDateStatus = { text: "PAGAMENTO EM DIA", icon: "😊", classes: "inline-flex items-center px-3 py-1.5 rounded-full text-sm font-bold shadow-md bg-green-500 text-white" };
                }
            }

            validatorShowResults({
                dueDate: parsedJson.vencimento,
                rawBarcode: parsedJson.codigo_barras,
                cleanedBarcode: cleanedBarcode,
                supplierName: parsedJson.fornecedor ? parsedJson.fornecedor.nome : null,
                supplierNumber: parsedJson.fornecedor ? parsedJson.fornecedor.numero : null,
                payerName: parsedJson.nome_pagador,
                paymentValue: parsedJson.valor,
                validationMsg: validationMessage,
                dueDateStatus: dueDateStatus
            });
        }

        // --- LÓGICA DE SALVAMENTO ---
        function saveGuideWithCustomName() {
            if (!validatorState.originalFile || !validatorState.extractedData) {
                alert('Não há dados suficientes para salvar o arquivo.');
                return;
            }

            const data = validatorState.extractedData;
            const id = validatorElements.idInput.value || 'SEM_ID';
            
            const newFileName = generateStandardFileName(data, id);

            const url = URL.createObjectURL(validatorState.originalFile);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = newFileName;
            document.body.appendChild(a);
            a.click();
            URL.revokeObjectURL(url);
            a.remove();
        }

        // --- LÓGICA DO BATCH INPUT ---
        function generateBatchInput() {
            if (!validatorState.extractedData) {
                alert('Não há dados extraídos para gerar o arquivo.');
                return;
            }
            const data = validatorState.extractedData;
            const contaContabil = validatorElements.tipoPagamentoSelect.value;

            if (!contaContabil) {
                alert('Por favor, selecione uma Área do Direito e um Tipo de Pagamento para gerar o Batch Input.');
                return;
            }

            const getCompanyCode = (payerName) => {
                if (!payerName) return 'EMPRESA_NAO_IDENTIFICADA';
                const upperPayerName = payerName.toUpperCase();
                if (upperPayerName.includes("CARREFOUR") || upperPayerName.includes("BOMPREÇO SUPERMERCADOS DO NORDESTE")) return "BR02";
                if (upperPayerName.includes("VERPARINVEST")) return "BR08";
                if (upperPayerName.includes("WMB SUPERMERCADOS")) return "BR21";
                if (upperPayerName.includes("WMS SUPERMERCADOS")) return "BR22";
                if (upperPayerName.includes("BOMPREÇO BAHIA")) return "BR24";
                if (upperPayerName.includes("TRANSPORTADORA BOMPREÇO")) return "BR25";
                return payerName.replace(/[^a-zA-Z0-9]/g, '_');
            };

            const companyCode = getCompanyCode(data.payerName);
            const today = new Date();
            const docDate = `${String(today.getDate()).padStart(2, '0')}.${String(today.getMonth() + 1).padStart(2, '0')}.${today.getFullYear()}`;
            const paymentValue = data.paymentValue ? parseFloat(data.paymentValue.replace(/\./g, '').replace(',', '.')) : 0;

            const headers = ["Data do Documento","Tipo de Documento","Empresa / Company Code","Data do Lançamento Contábil","Moeda","Nro. Docto Referência","Texto do Cabeçalho","Grupo de Ledger","Criar como pré-editado","Taxa de câmbio","Chave de Lançamento","Conta de Lançamento (Fornecedor / Despesas)","Montante (Valor)","Local de Negocio","Atribuicao do Documento","Texto do Documento","Condição de Pagamento","Data base do documento","Base desconto","Montante desconto","Bloqueio de Pagamento","Forma de Pagamento","Referência de Pagamento","Mont. Base Imposto","Código IVA","Flag do IVA","Domicilio Fiscal","Centro de Custo","Centro de Lucro","Ordem Interna","Razão Especial","Código da Receita","Competência, formato MMAAAA","Período Apuração, formato DDMMAAAA","Número de Referência","Receita Bruta","Percentual","Divida Ativa / Etiqueta","Nº Parcela / Notificação","Exercício","Renavan","Unidade da Federação","Código do Município","Placa do Veículo","Opção de Pagamento","Opção de Retirada","Origem","Identificador Uso Informação 1 e 2","Informação 1","Informação 2","Identificador","Lacre","Dígito do Lacre","Tipo de Contribuinte","Id Contribuinte","Número Inscrição","Tributo Exclusivo","Sociedade Parceira","Tipo de movimento","Linha digitavel do boleto","Nome","Rua e nº","Local","Código postal","Banco","Agência","Dígito"];
            
            const dataRows = [
                [docDate, 'KR', companyCode, docDate, 'BRL', null, null, null, null, null, 31, data.supplierNumber || null, paymentValue, null, null, null, null, data.dueDate || docDate, null, null, null, 'T', null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, data.cleanedBarcode || null, null, null, null, null, null, null, null],
                [null, null, null, null, null, null, null, null, null, null, 40, contaContabil, paymentValue, null, null, null, null, data.dueDate || docDate, null, null, null, 'T', null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null]
            ];

            const worksheet = XLSX.utils.aoa_to_sheet([headers, ...dataRows]);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Plan1");

            const fileName = `Batch_Input_${companyCode}_${docDate.replace(/\./g, '-')}.xlsx`;
            XLSX.writeFile(workbook, fileName);
        }

        function generateStandardFileName(data, id) {
            const getCompanyCode = (payerName) => {
                if (!payerName) return 'EMPRESA_NAO_IDENTIFICADA';
                const upperPayerName = payerName.toUpperCase();
                if (upperPayerName.includes("CARREFOUR") || upperPayerName.includes("BOMPREÇO SUPERMERCADOS DO NORDESTE")) return "BR02";
                if (upperPayerName.includes("VERPARINVEST")) return "BR08";
                if (upperPayerName.includes("WMB SUPERMERCADOS")) return "BR21";
                if (upperPayerName.includes("WMS SUPERMERCADOS")) return "BR22";
                if (upperPayerName.includes("BOMPREÇO BAHIA")) return "BR24";
                if (upperPayerName.includes("TRANSPORTADORA BOMPREÇO")) return "BR25";
                return payerName.replace(/[^a-zA-Z0-9]/g, '_');
            };

            let formattedValue = 'VALOR_NAO_ENCONTRADO';
            if (data.paymentValue) {
                let cleanValue = data.paymentValue.replace(/\./g, '');
                if (cleanValue.endsWith(',00')) {
                    cleanValue = cleanValue.substring(0, cleanValue.length - 3);
                }
                formattedValue = cleanValue;
            }

            const companyCode = getCompanyCode(data.payerName);
            let fileType = '';
            const barcodeLength = data.cleanedBarcode ? data.cleanedBarcode.length : 0;
            const supplierNumber = data.supplierNumber;

            if (barcodeLength === 48 && (supplierNumber === '3050000108' || supplierNumber === '3050000101')) {
                fileType = 'BB';
            } else if (barcodeLength === 48) {
                fileType = 'TRI';
            } else if (barcodeLength === 47) {
                fileType = 'BOL';
            } else {
                fileType = 'TIPO_DESCONHECIDO';
            }

            const originalFileName = validatorState.originalFile.name;
            const fileExtension = originalFileName.substring(originalFileName.lastIndexOf('.'));
            const newFileName = `${formattedValue}_${fileType}_${id}_${companyCode}${fileExtension}`;
            
            return newFileName;
        }


        // --- Lógica para as abas legadas (OCR, Barcode, Join PDF) ---
        const ocrPasteArea = document.getElementById('ocrPasteArea');
        const ocrLoading = document.getElementById('ocrLoading');
        const ocrLoadingText = document.getElementById('ocrLoadingText');
        const ocrContentArea = document.getElementById('ocrContentArea');
        const previewImage = document.getElementById('previewImage');
        const ocrTextResult = document.getElementById('ocrTextResult');
        const ocrFileInput = document.getElementById('ocrFileInput');
        const copyOcrBtn = document.getElementById('copyOcrBtn');
        const ocrProcessBtn = document.getElementById('ocrProcessBtn');
        let currentImageFile = null;
        let ocrWorker = null;

        function setupOcrEventListeners() {
            if(!ocrPasteArea) return;
            ocrPasteArea.addEventListener('paste', handleOcrPaste);
            ocrPasteArea.addEventListener('dragover', (e) => { e.preventDefault(); ocrPasteArea.classList.add('dragover'); });
            ocrPasteArea.addEventListener('dragleave', (e) => { e.preventDefault(); ocrPasteArea.classList.remove('dragover'); });
            ocrPasteArea.addEventListener('drop', handleOcrDrop);
            ocrFileInput.addEventListener('change', (e) => processOcrImage(e.target.files[0]));
        }

        function handleOcrPaste(e) { e.preventDefault(); const items = e.clipboardData.items; for (let i = 0; i < items.length; i++) { if (items[i].type.indexOf('image') !== -1) { processOcrImage(items[i].getAsFile()); break; } } }
        function handleOcrDrop(e) { e.preventDefault(); ocrPasteArea.classList.remove('dragover'); const files = e.dataTransfer.files; if (files.length > 0 && files[0].type.startsWith('image/')) { processOcrImage(files[0]); } }
        
        function processOcrImage(file) { 
            if (!file) return;
            if (file.size > 5 * 1024 * 1024) { ocrTextResult.innerHTML = '<div class="error-state">⚠️ Arquivo muito grande! Máximo 5MB.</div>'; return; } 
            const reader = new FileReader(); 
            reader.onload = function(e) { 
                previewImage.src = e.target.result; 
                currentImageFile = file; 
                ocrContentArea.style.display = 'grid'; 
                ocrTextResult.innerHTML = '<div class="empty-state">Clique em "Extrair Texto" para processar 👆</div>'; 
                copyOcrBtn.disabled = true; 
                ocrProcessBtn.disabled = false; 
            }; 
            reader.readAsDataURL(file); 
        }
        
        async function performOCR() {
            if (!currentImageFile) return;
            showOcrLoading('Iniciando processo OCR...');
            try {
                if (!ocrWorker) {
                    ocrWorker = await Tesseract.createWorker({
                        logger: m => {
                            const statusText = m.status === 'recognizing text' ? `Extraindo texto... ${Math.round(m.progress * 100)}%` : 'Carregando engine OCR...';
                            ocrLoadingText.textContent = statusText;
                        }
                    });
                }
                await ocrWorker.loadLanguage('eng');
                await ocrWorker.initialize('eng');
                await ocrWorker.setParameters({ tessedit_char_whitelist: '0123456789' });
                const { data: { text } } = await ocrWorker.recognize(currentImageFile);
                const cleanText = text.replace(/[^0-9]/g, '');
                ocrTextResult.innerHTML = `<div class="success-state">✅ Texto extraído!</div>${cleanText}<div class="character-count-info">Caracteres: ${cleanText.length}</div>`;
                copyOcrBtn.disabled = false;
            } catch (error) {
                console.error('Erro no OCR:', error);
                ocrTextResult.innerHTML = `<div class="error-state">❌ Erro no processamento OCR</div>`;
            } finally {
                hideOcrLoading();
            }
        }

        function showOcrLoading(message) { ocrLoading.style.display = 'block'; ocrLoadingText.textContent = message; ocrProcessBtn.disabled = true; }
        function hideOcrLoading() { ocrLoading.style.display = 'none'; ocrProcessBtn.disabled = false; }
        function copyOcrText() { const text = document.getElementById('ocrTextResult').innerText.replace(/✅.*\n/, '').replace(/Caracteres: \d+/, '').trim(); if (text) { fallbackCopyTextToClipboard(text, copyOcrBtn); } }
        
        // Barcode Cleaner
        const barcodeInput = document.getElementById('barcodeInput');
        const cleanBarcodeBtn = document.getElementById('cleanBarcodeBtn');
        const cleanedBarcodeResult = document.getElementById('cleanedBarcodeResult');
        const copyBarcodeBtn = document.getElementById('copyBarcodeBtn');

        function setupBarcodeCleanerEventListeners() {
            if (!barcodeInput) return;
            barcodeInput.addEventListener('input', () => {
                const hasText = barcodeInput.value.trim().length > 0;
                cleanBarcodeBtn.disabled = !hasText;
                copyBarcodeBtn.disabled = true; 
                if (!hasText) {
                    cleanedBarcodeResult.innerHTML = '<div class="empty-state">O código de barras limpo aparecerá aqui.</div>';
                }
            });
            cleanBarcodeBtn.disabled = true; 
            copyBarcodeBtn.disabled = true;
        }

        function cleanBarcode() {
            const cleaned = barcodeInput.value.replace(/\D/g, '');
            if (cleaned.length > 0) {
                cleanedBarcodeResult.innerHTML = `<div class="success-state">✅ Código limpo!</div>${cleaned}<div class="character-count-info">Caracteres: ${cleaned.length}</div>`;
                copyBarcodeBtn.disabled = false;
            } else {
                cleanedBarcodeResult.innerHTML = '<div class="empty-state">O código de barras limpo aparecerá aqui.</div>';
                copyBarcodeBtn.disabled = true;
            }
        }
        function copyBarcode() { const cleaned = barcodeInput.value.replace(/\D/g, ''); if (cleaned) { fallbackCopyTextToClipboard(cleaned, copyBarcodeBtn); } }

        // PDF Joiner
        const pdfElements = {
            fileInput: document.getElementById('pdfFileInput'),
            fileList: document.getElementById('pdfFileList'),
            processBtn: document.getElementById('joinPdfProcessBtn'),
            loading: document.getElementById('pdfLoading'),
            outputArea: document.getElementById('pdfOutputArea'),
            mergedResult: document.getElementById('mergedPdfResult'),
            downloadBtn: document.getElementById('downloadPdfBtn'),
            dropArea: document.getElementById('pdfDropArea'),
        };
        let selectedPdfFiles = [];
        let mergedPdfBytes = null;

        function setupPdfJoinerEventListeners() {
            if (!pdfElements.dropArea) return;
            pdfElements.dropArea.addEventListener('dragover', (e) => { e.preventDefault(); e.stopPropagation(); pdfElements.dropArea.classList.add('dragover'); });
            pdfElements.dropArea.addEventListener('dragleave', (e) => { e.preventDefault(); e.stopPropagation(); pdfElements.dropArea.classList.remove('dragover'); });
            pdfElements.dropArea.addEventListener('drop', (e) => { e.preventDefault(); e.stopPropagation(); pdfElements.dropArea.classList.remove('dragover'); const files = Array.from(e.dataTransfer.files).filter(f => f.type === 'application/pdf'); addPdfFilesToList(files); });
            pdfElements.fileInput.addEventListener('change', (e) => addPdfFilesToList(Array.from(e.target.files)));
            pdfElements.downloadBtn.addEventListener('click', downloadMergedPdf);
        }

        function addPdfFilesToList(files) { files.forEach(file => { if (!selectedPdfFiles.some(f => f.name === file.name && f.size === file.size)) { selectedPdfFiles.push(file); } }); renderPdfFileList(); updateJoinPdfButtonState(); }
        function removePdfFile(fileName) { selectedPdfFiles = selectedPdfFiles.filter(file => file.name !== fileName); renderPdfFileList(); updateJoinPdfButtonState(); }
        function renderPdfFileList() { pdfElements.fileList.innerHTML = ''; selectedPdfFiles.forEach(file => { const li = document.createElement('li'); li.textContent = file.name; const btn = document.createElement('button'); btn.textContent = '×'; btn.className = 'remove-file-btn'; btn.onclick = () => removePdfFile(file.name); li.appendChild(btn); pdfElements.fileList.appendChild(li); }); }
        function updateJoinPdfButtonState() { pdfElements.processBtn.disabled = selectedPdfFiles.length < 2; if (selectedPdfFiles.length === 0) { pdfElements.outputArea.style.display = 'none'; pdfElements.downloadBtn.disabled = true; } }
        
        async function joinPdfs() { 
            if (selectedPdfFiles.length < 2) return; 
            pdfElements.loading.style.display = 'block'; 
            pdfElements.processBtn.disabled = true; 
            try { 
                const { PDFDocument } = PDFLib; 
                const mergedPdf = await PDFDocument.create(); 
                for (const file of selectedPdfFiles) { 
                    const arrayBuffer = await file.arrayBuffer(); 
                    const pdfDoc = await PDFDocument.load(arrayBuffer, { ignoreEncryption: true }); 
                    const copiedPages = await mergedPdf.copyPages(pdfDoc, pdfDoc.getPageIndices()); 
                    copiedPages.forEach(page => mergedPdf.addPage(page)); 
                } 
                mergedPdfBytes = await mergedPdf.save(); 
                pdfElements.outputArea.style.display = 'flex'; 
                pdfElements.mergedResult.innerHTML = `<div class="success-state">✅ PDFs unidos! Total de páginas: ${mergedPdf.getPageCount()}</div>`; 
                pdfElements.downloadBtn.disabled = false; 
            } catch (error) { 
                console.error(error); 
                pdfElements.mergedResult.innerHTML = `<div class="error-state">❌ Erro ao juntar PDFs. Verifique se não estão protegidos.</div>`; 
            } finally { 
                pdfElements.loading.style.display = 'none'; 
                pdfElements.processBtn.disabled = false; 
            } 
        }
        function downloadMergedPdf() { if (mergedPdfBytes) { const blob = new Blob([mergedPdfBytes], { type: 'application/pdf' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'pdfs_juntos_carrefour.pdf'; a.click(); URL.revokeObjectURL(url); } }
        
        function fallbackCopyTextToClipboard(text, buttonElement) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                const originalText = buttonElement.textContent;
                buttonElement.textContent = `✅ Copiado!`;
                buttonElement.style.background = 'linear-gradient(45deg, #4CAF50, #2E7D32)';
                setTimeout(() => {
                    buttonElement.textContent = originalText;
                    buttonElement.style.background = 'linear-gradient(45deg, #ED1C24, #C00000)';
                }, 2000);
            } catch (err) {
                console.error('Falha ao copiar');
            }
            document.body.removeChild(textArea);
        }

        // --- Inicialização da Página ---
        function setupBatchInputFields() {
            const areaSelect = validatorElements.areaDireitoSelect;
            const tipoSelect = validatorElements.tipoPagamentoSelect;

            areaSelect.innerHTML = '<option value="">Selecione a Área</option>';
            
            for (const area in contasContabeis) {
                const option = document.createElement('option');
                option.value = area;
                option.textContent = area;
                areaSelect.appendChild(option);
            }

            areaSelect.addEventListener('change', () => {
                const selectedArea = areaSelect.value;
                tipoSelect.innerHTML = '<option value="">Selecione o Tipo</option>';
                
                if (selectedArea && contasContabeis[selectedArea]) {
                    tipoSelect.disabled = false;
                    const tipos = contasContabeis[selectedArea];
                    for (const tipo in tipos) {
                        const option = document.createElement('option');
                        option.value = tipos[tipo];
                        option.textContent = tipo;
                        tipoSelect.appendChild(option);
                    }
                } else {
                    tipoSelect.disabled = true;
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            openTab('validatorTab');
            setupValidatorEventListeners();
            setupOcrEventListeners();
            setupBarcodeCleanerEventListeners();
            setupPdfJoinerEventListeners();
            setupBatchInputFields(); 
            updateJoinPdfButtonState();
        });
    </script>
</body>
</html>
